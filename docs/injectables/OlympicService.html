<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>olympic-games-starter documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">olympic-games-starter documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >OlympicService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/olympic.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Service métier destiné à gérer les données liées aux Jeux Olympiques (Olympics). Il utilise un BehaviorSubject pour
mettre en cache localement les données, afin de limiter les requêtes HTTP et de fournir un accès centralisé et
réactif aux données.
Ce service inclut plusieurs fonctionnalités, telles que le calcul des données statistiques pour un tableau de bord
ou des graphiques.</p>

            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#olympics$" >olympics$</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#olympicUrl" >olympicUrl</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#subject" >subject</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#getHomeStats" >getHomeStats</a>
                            </li>
                            <li>
                                <a href="#getMedalsChartLineByOlympic" >getMedalsChartLineByOlympic</a>
                            </li>
                            <li>
                                <a href="#getMedalsChartLineByOlympicV2" >getMedalsChartLineByOlympicV2</a>
                            </li>
                            <li>
                                <a href="#getMedalsPieData" >getMedalsPieData</a>
                            </li>
                            <li>
                                <a href="#getOlympicById" >getOlympicById</a>
                            </li>
                            <li>
                                <a href="#getOlympics" >getOlympics</a>
                            </li>
                            <li>
                                <a href="#getOlympicStatsOfCountryId" >getOlympicStatsOfCountryId</a>
                            </li>
                            <li>
                                <a href="#loadInitialData" >loadInitialData</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#refreshDataCache" >refreshDataCache</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(http: HttpClient, loadingService: <a href="../injectables/LoadingService.html" target="_self">LoadingService</a>, messagesService: <a href="../injectables/MessagesService.html" target="_self">MessagesService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/app/core/services/olympic.service.ts:26</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>http</td>
                                                  
                                                        <td>
                                                                    <code>HttpClient</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>loadingService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/LoadingService.html" target="_self" >LoadingService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>messagesService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/MessagesService.html" target="_self" >MessagesService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getHomeStats"></a>
                    <span class="name">
                        <span ><b>getHomeStats</b></span>
                        <a href="#getHomeStats"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getHomeStats()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="119"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:119</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Statistiques à présenter sur le dashboard principal (Home)
Pour l&#39;instant, il y a deux statistiques :</p>
<ul>
<li>Nombre de JOs</li>
<li>Nombre de pays
La structure est évolutive. Il suffit d&#39;ajouter une statistique dans le tableau retourné
et elles seront dynamiquement affichées dans le composant d&#39;affichage réutilisable.
   le nombre d&#39;années uniques de participations.</li>
</ul>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Observable&lt;BoxStats&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Un Observable incluant un tableau de BoxStat avec le nombre de pays participants et
le nombre d&#39;années uniques de participations.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMedalsChartLineByOlympic"></a>
                    <span class="name">
                        <span ><b>getMedalsChartLineByOlympic</b></span>
                        <a href="#getMedalsChartLineByOlympic"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMedalsChartLineByOlympic(olympicId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="219"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:219</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Récupère les données de la série de médailles (graphe Line) pour un événement olympique (country) spécifique.</p>
<p>contenant les informations de médaille pour le country/olympic</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>olympicId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>ID de l&#39;Olympic</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/ChartLine.html" target="_self" >Observable&lt;ChartLine | undefined&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>Observable émettant un ChartLine avec son array d&#39;objets ChartLineSeries
contenant les informations de médaille pour le country/olympic</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMedalsChartLineByOlympicV2"></a>
                    <span class="name">
                        <span ><b>getMedalsChartLineByOlympicV2</b></span>
                        <a href="#getMedalsChartLineByOlympicV2"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMedalsChartLineByOlympicV2(olympicId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="256"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:256</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p> Méthode pour démo d&#39;évolutivité possible grâce à la souplesse du composant.
 Ici on ajoute sans difficulté une 2ème série représentant la moyenne du nombre de médailles pour les autres
 pays.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>olympicId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>=id du pays</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/ChartLine.html" target="_self" >Observable&lt;ChartLine | undefined&gt;</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMedalsPieData"></a>
                    <span class="name">
                        <span ><b>getMedalsPieData</b></span>
                        <a href="#getMedalsPieData"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getMedalsPieData()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="148"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:148</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Traite les données des Jeux olympiques pour créer une liste d&#39;objets représentant
la distribution des médailles par pays.</p>
<p>qui correspondent aux données requises composant ngx-charts-pie-chart</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/ChartPie.html" target="_self" >Observable&lt;ChartPie[]&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>Un observable émettant un tableau d&#39;objets ChartPie,
qui correspondent aux données requises composant ngx-charts-pie-chart</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOlympicById"></a>
                    <span class="name">
                        <span ><b>getOlympicById</b></span>
                        <a href="#getOlympicById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getOlympicById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="206"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:206</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Données d&#39;un seul pays à partir de son identifiant.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>L&#39;identifiant du pays.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Olympic.html" target="_self" >Observable&lt;Olympic | undefined&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>Un Observable contenant les données du pays correspondant.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOlympics"></a>
                    <span class="name">
                        <span ><b>getOlympics</b></span>
                        <a href="#getOlympics"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getOlympics()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="315"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:315</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOlympicStatsOfCountryId"></a>
                    <span class="name">
                        <span ><b>getOlympicStatsOfCountryId</b></span>
                        <a href="#getOlympicStatsOfCountryId"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getOlympicStatsOfCountryId(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="171"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:171</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Données statistiques d&#39;un seul pays à partir de son identifiant.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>L&#39;identifiant du pays.</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Observable&lt;BoxStats | undefined&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Un Observable contenant les stats du pays, y compris son id et son nom.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadInitialData"></a>
                    <span class="name">
                        <span ><b>loadInitialData</b></span>
                        <a href="#loadInitialData"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>loadInitialData()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="81"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:81</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Les données sont mises en cache dans le BehaviorSubject via tap
afin d&#39;avoir une gestion d&#39;état simple et éviter des appels http get trop nombreux.
Les données sont ainsi accessibles à tout moment via l&#39;observable olympics$.
La méthode <a href="refreshDataCache()">refreshDataCache()</a> est plus &quot;safe&quot; car elle récupère le flux et limite à une lecture en
évitant d&#39;enregistrer trop d&#39;éléments (inutiles) dans le cache et en fermant .
QUESTION : j&#39;hésite à mettre cette méthode de service en private car elle est susceptible d&#39;une mauvaise
utilisation si le développeur oublie de faire un take(1). De plus, si elle est appelée intempestivement
plusieurs fois sans le take(1), elle peut déclencher des écoutes multiples non souhaitées.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Olympic.html" target="_self" >Observable&lt;Olympic[]&gt;</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refreshDataCache"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>refreshDataCache</b></span>
                        <a href="#refreshDataCache"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>refreshDataCache()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="54"
                                    class="link-to-prism">src/app/core/services/olympic.service.ts:54</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Rafraichit les données dans le cache (en s&#39;assurant de bien gérer le BehaviorSubject sous-jacent)
Utiliser cette méthode de préférence pour actualiser le flux</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                <p>Cette méthode ne renvoie aucune valeur mais recharge les données et enregistre la sortie pour le débogage</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="olympics$"></a>
                    <span class="name">
                        <span ><b>olympics$</b></span>
                        <a href="#olympics$"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>this.subject.asObservable()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/app/core/services/olympic.service.ts:26</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="olympicUrl"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>olympicUrl</b></span>
                        <a href="#olympicUrl"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>&#x27;./assets/mock/olympic.json&#x27;</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/core/services/olympic.service.ts:23</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subject"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>subject</b></span>
                        <a href="#subject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new BehaviorSubject&lt;Olympic[]&gt;([])</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/app/core/services/olympic.service.ts:25</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {HttpClient} from &#x27;@angular/common/http&#x27;;
import {Injectable} from &#x27;@angular/core&#x27;;
import {BehaviorSubject, delay, finalize, map, Observable, take, throwError} from &#x27;rxjs&#x27;;
import {catchError, tap} from &#x27;rxjs/operators&#x27;;
import {Olympic} from &quot;../models/Olympic&quot;;
import {ChartPie} from &quot;../models/stats/ChartPie&quot;;
import {LoadingService} from &quot;./loading.service&quot;;
import {BoxStats} from &quot;../models/stats/BoxStats&quot;;
import {MessagesService} from &quot;./messages.service&quot;;
import {ChartLine} from &quot;../models/stats/ChartLine&quot;;

/**
 * Service métier destiné à gérer les données liées aux Jeux Olympiques (Olympics). Il utilise un BehaviorSubject pour
 * mettre en cache localement les données, afin de limiter les requêtes HTTP et de fournir un accès centralisé et
 * réactif aux données.
 * Ce service inclut plusieurs fonctionnalités, telles que le calcul des données statistiques pour un tableau de bord
 * ou des graphiques.
 */
@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class OlympicService {
  private olympicUrl &#x3D; &#x27;./assets/mock/olympic.json&#x27;;

  private subject &#x3D; new BehaviorSubject&lt;Olympic[]&gt;([]);
  olympics$ &#x3D; this.subject.asObservable();

  constructor(
    private http: HttpClient,
    private loadingService: LoadingService,
    private messagesService: MessagesService) {
    /*
    Faire le subscribe dans le constructor permet de renseigner effectivement le cache, rendant les données
    accessibles à tout moment via l&#x27;observable olympics$, sans besoin de refaire une requête HTTP.
    Tous les appels de service qui se reposent sur olympics$ sont ainsi assurés que le chargement de données est
    terminé.
    Si besoin, la méthode loadInitialData() pourrait être utilisée dans d&#x27;autres
    endroits de l&#x27;appli (par exemple sur un bouton Refresh pour obtenir les dernières données actualisées).
    Attention dans ce dernier cas, les développeurs ne devront pas oublier de faire le take(1) afin de
    limiter la souscription à un seul événement pour empêcher des écoutes inutiles ou récurrentes,
    et terminer la souscription proprement (en évitant ainsi des fuites mémoires).
    Pour prévenir de cette mauvaise utilisation potentielle, j&#x27;ai refactorisé vers une méthode
    refreshDataCache() public qui s&#x27;occupe de la gestion du BehaviorObject.
     */
    //console.log(&#x27;OlympicService constructor (Singleton) ; appel de refreshDataCache() &#x3D;&gt; loadInitialData&#x27;);
    this.refreshDataCache();
  }

  /**
   * Rafraichit les données dans le cache (en s&#x27;assurant de bien gérer le BehaviorSubject sous-jacent)
   * Utiliser cette méthode de préférence pour actualiser le flux
   * @return {void} Cette méthode ne renvoie aucune valeur mais recharge les données et enregistre la sortie pour le débogage
   */
  public refreshDataCache() {
    // méthode 1
    //  this.loadInitialData().pipe(
    //   take(1)// Prend juste la 1ère donnée et se complète automatiquement (&#x3D;&gt; unsubscribe)
    //   // On met take(1) ici et non pas dans loadInitialData pour plus de flexibilité
    // ).subscribe(data &#x3D;&gt; console.log(&#x27;OlympicService.refreshDataCache() ; Data reçues dans subscribe : &#x27;, data));

    //solution 2 pour loading (moins intrusive)
    this.loadingService.showLoaderUntilCompleted(//&quot;ajoute/greffe&quot; au cycle de vie de l&#x27;observable en paramètre la gestion du loading
      this.loadInitialData().pipe(
        take(1)// Prend juste la 1ère donnée et se complète automatiquement (&#x3D;&gt; unsubscribe)
        // On met take(1) ici et non pas dans loadInitialData pour plus de flexibilité
      )
    ).subscribe(data &#x3D;&gt; console.log(&#x27;OlympicService.refreshDataCache() ; Data reçues dans subscribe : &#x27;, data));

  }

  /**
   * Les données sont mises en cache dans le BehaviorSubject via tap
   * afin d&#x27;avoir une gestion d&#x27;état simple et éviter des appels http get trop nombreux.
   * Les données sont ainsi accessibles à tout moment via l&#x27;observable olympics$.
   * La méthode {@link refreshDataCache()} est plus &quot;safe&quot; car elle récupère le flux et limite à une lecture en
   * évitant d&#x27;enregistrer trop d&#x27;éléments (inutiles) dans le cache et en fermant .
   * QUESTION : j&#x27;hésite à mettre cette méthode de service en private car elle est susceptible d&#x27;une mauvaise
   * utilisation si le développeur oublie de faire un take(1). De plus, si elle est appelée intempestivement
   * plusieurs fois sans le take(1), elle peut déclencher des écoutes multiples non souhaitées.
   */
  loadInitialData(): Observable&lt;Olympic[]&gt; {
    //console.log(&#x27;OlympicService.loadInitialData() : appel backend&#x27;)
    //this.loadingService.loadingOn();//SOLUTION 1 pour LOADING
    //return this.http.get&lt;Olympic[]&gt;(&#x27;FichierInexistant.json&#x27;)//pour simuler 404
    return this.http.get&lt;Olympic[]&gt;(this.olympicUrl)
      .pipe(
        //filter(data &#x3D;&gt; data.length &gt; 0),
        //delay(2000), // délai de 2 secondes pour test affichage du loading
        catchError(err &#x3D;&gt; {
          const message &#x3D; &quot;Impossible de charger les données Olympiques&quot;;
          //affichage de l&#x27;erreur pour l&#x27;utilisateur
          this.messagesService.showErrors(message);//service réactif partagé
          //Temporaire : Affichage de l&#x27;erreur technique dans la console
          //TODO à remplacer par un log serveur (elastik stack, sentry) dans la vraie vie
          console.error(message, err);
          return throwError(err);
        }),
        tap(olympics &#x3D;&gt; {
          //console.log(&#x27;OlympicService.loadInitialData() tap : data (mise en cache dans le BehaviorSubject)&#x27;, olympics);
          this.subject.next(olympics)//dès lors qu&#x27;on inscrit le flux Observable de http.get vers le cache
                                     //BehaviorSubject, l&#x27;observable olympics$ en variable membre est associé à ce sujet
                                     //en tant que simple Observable (sans possibilité de le modifier)
                                     //Toutes nos méthodes de service se reposent sur olympics$ (non modifiable)
        }),
        //finalize(()&#x3D;&gt;this.loadingService.loadingOff())  //SOLUTION 1 pour LOADING
      );
  }

  /**
   * Statistiques à présenter sur le dashboard principal (Home)
   * Pour l&#x27;instant, il y a deux statistiques :
   * - Nombre de JOs
   * - Nombre de pays
   * La structure est évolutive. Il suffit d&#x27;ajouter une statistique dans le tableau retourné
   * et elles seront dynamiquement affichées dans le composant d&#x27;affichage réutilisable.
   * @returns Un Observable incluant un tableau de BoxStat avec le nombre de pays participants et
   *          le nombre d&#x27;années uniques de participations.
   */
  getHomeStats(): Observable&lt;BoxStats&gt; {
    //console.log(&#x27;appel OlympicService.getHomeStats()&#x27;);
    return this.olympics$.pipe(
      map((olympics: Olympic[]) &#x3D;&gt; {
        const totalCountries &#x3D; olympics.length; // Chaque entrée correspond à un pays
        const yearSet &#x3D; new Set&lt;number&gt;(); // Utilisation d&#x27;un Set pour conserver les années uniques

        // Remplir le Set avec les différentes années de participation
        olympics.forEach((o: Olympic) &#x3D;&gt; {
          o.participations.forEach(p &#x3D;&gt; yearSet.add(p.year));
        });

        const totalYears &#x3D; yearSet.size; // Nombre d&#x27;années uniques
        return {
          name: &#x27;Médailles par pays&#x27;,
          stats: [{label: &#x27;Nombre de JOs&#x27;, value: totalYears}, {label: &#x27;Nombre de pays&#x27;, value: totalCountries}]
        };
      }),
      tap(stats &#x3D;&gt; console.log(&#x27;OlympicService.getHomeStats data&#x27;, stats))
    );
  }

  /**
   * Traite les données des Jeux olympiques pour créer une liste d&#x27;objets représentant
   * la distribution des médailles par pays.
   *
   * @return {Observable&lt;ChartPie[]&gt;} Un observable émettant un tableau d&#x27;objets ChartPie,
   * qui correspondent aux données requises composant ngx-charts-pie-chart
   */
  getMedalsPieData(): Observable&lt;ChartPie[]&gt; {
    //console.log(&#x27;appel OlympicService.getMedalsPieData()&#x27;);
    return this.olympics$.pipe(
      map((olympics: Olympic[]) &#x3D;&gt;
        olympics.map((o: Olympic) &#x3D;&gt; ({
          name: o.country,
          value: o.participations.reduce((accumulator, current) &#x3D;&gt; accumulator + current.medalsCount, 0), // Total des médailles
          extra: {id: o.id}
        }))
      ),
      tap(
        data &#x3D;&gt; {
        console.log(&#x27;OlympicService.getMedalsPieData data&#x27;, data)
        }
      )
    );
  }

  /**
   * Données statistiques d&#x27;un seul pays à partir de son identifiant.
   * @param id L&#x27;identifiant du pays.
   * @returns Un Observable contenant les stats du pays, y compris son id et son nom.
   */
  getOlympicStatsOfCountryId(id: number): Observable&lt;BoxStats | undefined&gt; {
    console.log(&#x27;appel OlympicService.getOlympicStatsOfCountryId(&#x27; + id + &#x27;)&#x27;);
    return this.olympics$.pipe(
      map((olympics: Olympic[]) &#x3D;&gt; {
        const country &#x3D; olympics.find((o: Olympic) &#x3D;&gt; o.id &#x3D;&#x3D;&#x3D; id);
        if (country) {
          const totalParticipations &#x3D; country.participations.length;
          const totalAthletes &#x3D; country.participations.reduce((acc, curr) &#x3D;&gt; acc + curr.athleteCount, 0);
          const totalMedals &#x3D; country.participations.reduce((acc, curr) &#x3D;&gt; acc + curr.medalsCount, 0);
          const averageAthletesPerParticipation &#x3D; totalParticipations &gt; 0 ? (totalAthletes / totalParticipations) : 0;
          const averageMedalsPerParticipation &#x3D; totalParticipations &gt; 0 ? (totalMedals / totalParticipations) : 0;

          return {
            name: country.country,
            stats: [
              {label: &#x27;Nombre de participations&#x27;, value: totalParticipations},
              {label: &#x27;Nombre total de médailles&#x27;,value: totalMedals},
              {label: &#x27;Nombre total d\&#x27;athlètes&#x27;, value: totalAthletes},
              // {label: &#x27;Moyenne d\&#x27;athlètes par participation&#x27;,value: parseFloat(averageAthletesPerParticipation.toFixed(0))},
              // {label: &#x27;Moyenne de médailles par participation&#x27;,value: parseFloat(averageMedalsPerParticipation.toFixed(0))}
            ]
          };
        }
        return undefined;
      }),
      tap(data &#x3D;&gt; console.log(&#x27;OlympicService.getOlympicStatsOfCountryId &#x3D;&gt; data : &#x27;, data))
    );
  }

  /**
   * Données d&#x27;un seul pays à partir de son identifiant.
   *
   * @param id L&#x27;identifiant du pays.
   * @returns Un Observable contenant les données du pays correspondant.
   */
  getOlympicById(id: number): Observable&lt;Olympic | undefined&gt; {
    return this.olympics$.pipe(
      map((olympics: Olympic[]) &#x3D;&gt; olympics.find((o: Olympic) &#x3D;&gt; o.id &#x3D;&#x3D;&#x3D; id))
    );
  }

  /**
   * Récupère les données de la série de médailles (graphe Line) pour un événement olympique (country) spécifique.
   *
   * @param {number} olympicId - ID de l&#x27;Olympic
   * @return {Observable&lt;ChartLine&gt;} Observable émettant un ChartLine avec son array d&#x27;objets ChartLineSeries
   * contenant les informations de médaille pour le country/olympic
   */
  getMedalsChartLineByOlympic(olympicId: number): Observable&lt;ChartLine | undefined&gt; {
    //console.log(&#x27;appel OlympicService.getMedalsChartLineByOlympic(&#x27; + olympicId + &#x27;)&#x27;);
    return this.olympics$.pipe(
      map((data) &#x3D;&gt; {
        // Recherche de l&#x27;Olympic au param olympicId
        const olympic: Olympic | undefined &#x3D; data.find((item: Olympic) &#x3D;&gt; item.id &#x3D;&#x3D;&#x3D; olympicId);
        if (!olympic) {
          //throw new Error(&#x60;Aucun Olympic trouvé pour l&#x27;ID ${olympicId}&#x60;);
          return undefined; // En cas d&#x27;actualisation, retourner undefined pour respecter le type Observable&lt;ChartLine | undefined&gt;.
        }
        // Construction de l&#x27;objet ChartLineSeries
        const chartLine: ChartLine &#x3D; {
          xAxisLabel: &#x27;Dates&#x27;,
          yAxisLabel: &#x27;Nombre de médailles&#x27;,
          seriesLines: [
            {
              name: olympic.country,
              series:
                olympic.participations.map(part &#x3D;&gt; ({
                  name: &#x60;${part.year}&#x60;, // Convertir l&#x27;année en chaîne
                  value: part.medalsCount
                }))
            }
          ]
        };
        return chartLine; // Retourner un descriptif de chart avec les données de séries
      }),
      tap(data &#x3D;&gt; console.log(&#x27;OlympicService.getMedalsChartLineByOlympic &#x3D;&gt; data : &#x27;, data))
    );
  }

  /**
   *  Méthode pour démo d&#x27;évolutivité possible grâce à la souplesse du composant.
   *  Ici on ajoute sans difficulté une 2ème série représentant la moyenne du nombre de médailles pour les autres
   *  pays.
   * @param olympicId &#x3D;id du pays
   */
  getMedalsChartLineByOlympicV2(olympicId: number): Observable&lt;ChartLine | undefined&gt; {
    return this.olympics$.pipe(
      map((data) &#x3D;&gt; {
        // Recherche de l&#x27;Olympic pour l&#x27;ID donné
        const olympic: Olympic | undefined &#x3D; data.find((item: Olympic) &#x3D;&gt; item.id &#x3D;&#x3D;&#x3D; olympicId);
        if (!olympic) {
          // Aucun Olympic trouvé pour cet ID
          return undefined;
        }

        // Calcul de la moyenne de médailles par année pour tous les pays, sauf celui en cours
        const excludedOlympicId &#x3D; olympic.id; // ID du pays à exclure
        const averageSeries &#x3D; olympic.participations.map(participation &#x3D;&gt; {
          const year &#x3D; participation.year;

          // Calculer la moyenne pour cette année
          const totalMedals &#x3D; data
            .filter(o &#x3D;&gt; o.id !&#x3D;&#x3D; excludedOlympicId) // Exclure le pays en cours
            .reduce((sum, otherCountry) &#x3D;&gt; {
              const yearParticipation &#x3D; otherCountry.participations.find(p &#x3D;&gt; p.year &#x3D;&#x3D;&#x3D; year);
              return sum + (yearParticipation ? yearParticipation.medalsCount : 0);
            }, 0);

          // Nombre total de pays participant cette année (hors exclu)
          const participatingCountries &#x3D; data.filter(o &#x3D;&gt; o.id !&#x3D;&#x3D; excludedOlympicId)
            .filter(o &#x3D;&gt; o.participations.some(p &#x3D;&gt; p.year &#x3D;&#x3D;&#x3D; year)).length;

          const avgMedals &#x3D; participatingCountries &gt; 0 ? totalMedals / participatingCountries : 0;

          return {
            name: &#x60;${year}&#x60;,
            value: avgMedals // Moyenne de médailles
          };
        });

        // Construction des données pour le graphique
        const chartLine: ChartLine &#x3D; {
          xAxisLabel: &#x27;Dates&#x27;,
          yAxisLabel: &#x27;Nombre de médailles&#x27;,
          seriesLines: [
            {
              name: olympic.country, // Série pour le pays sélectionné
              series: olympic.participations.map(part &#x3D;&gt; ({
                name: &#x60;${part.year}&#x60;, // Année
                value: part.medalsCount // Médailles pour cette année
              }))
            },
            {
              name: &#x27;Moyenne globale (hors pays sélectionné)&#x27;, // Série pour la moyenne
              series: averageSeries
            }
          ]
        };
        return chartLine;
      }),
      tap(data &#x3D;&gt; console.log(&#x27;OlympicService.getMedalsChartLineByOlympic &#x3D;&gt; data : &#x27;, data))
    );
  }

  getOlympics() {
    return this.olympics$;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'OlympicService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
